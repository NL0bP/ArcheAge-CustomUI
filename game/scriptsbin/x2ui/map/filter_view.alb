function CreateFilterCheckGroupWindow(id, parent, type)  local info = {}  info.insetY = 23  info.offsetY = 5  info.menuTexts = {}  local filterTable = {}  if type == "normal" then    filterTable = mapLocale.filtericon_table    info.iconInfo = {}  elseif type == "npc" then    filterTable = mapLocale.filtericon_npc_table    table.insert(info.menuTexts, locale.map.allIcon)    info.subMenuTexts = {}    info.subIconInfo = {}    info.subOffsetX = 0    info.offsetX = -7  elseif type == "doodad" then    filterTable = mapLocale.filtericon_doodad_table    table.insert(info.menuTexts, locale.map.allIcon)    info.subMenuTexts = {}    info.subIconInfo = {}    info.subOffsetX = 0    info.offsetX = -7  elseif type == "house" then    filterTable = mapLocale.filtericon_house_table    table.insert(info.menuTexts, locale.map.allIcon)    info.subMenuTexts = {}    info.subIconInfo = {}    info.subOffsetX = 0    info.offsetX = -7  end  for i = 1, #filterTable do    if type == "normal" then      local symbol = X2Map:GetMapIconText(filterTable[i])      info.menuTexts[i] = locale.map.getSymbolText(symbol)      info.iconInfo[i] = {}      info.iconInfo[i].path = TEXTURE_PATH.MAP_ICON      info.iconInfo[i].width = M_ICON_EXTENT * 0.9      info.iconInfo[i].height = M_ICON_EXTENT * 0.9      info.iconInfo[i].x = npcCoordsList[filterTable[i]][1]      info.iconInfo[i].y = npcCoordsList[filterTable[i]][2]      info.iconInfo[i].coordWidth = npcCoordsList[filterTable[i]][3]      info.iconInfo[i].coordHeight = npcCoordsList[filterTable[i]][4]      info.iconInfo[i].anchorX = -3      info.iconInfo[i].anchorY = 1    else      local symbol = X2Map:GetMapIconText(filterTable[i])      info.subMenuTexts[i] = locale.map.getSymbolText(symbol)      info.subIconInfo[i] = {}      info.subIconInfo[i].path = TEXTURE_PATH.MAP_ICON      info.subIconInfo[i].width = M_ICON_EXTENT * 0.9      info.subIconInfo[i].height = M_ICON_EXTENT * 0.9      info.subIconInfo[i].x = npcCoordsList[filterTable[i]][1]      info.subIconInfo[i].y = npcCoordsList[filterTable[i]][2]      info.subIconInfo[i].coordWidth = npcCoordsList[filterTable[i]][3]      info.subIconInfo[i].coordHeight = npcCoordsList[filterTable[i]][4]      info.subIconInfo[i].anchorX = -3      info.subIconInfo[i].anchorY = 2    end  end  local window = CreateCheckGroupWindow(id, parent, info)  if type == "normal" and info.menuTexts ~= nil then    for i = 1, #filterTable do      window.checks[i].iconType = filterTable[i]      attachParam = {        "RIGHT",        window.checks[i],        "LEFT",        0,        0      }      ApplyEllipsisText(window.checks[i].textButton, 120, attachParam)    end  end  if type ~= "normal" and info.subMenuTexts ~= nil then    for i = 1, #filterTable do      local subChecks = window.subChecks[i]      subChecks.iconType = filterTable[i]      attachParam = {        "RIGHT",        subChecks,        "LEFT",        0,        0      }      ApplyEllipsisText(subChecks.textButton, 120, attachParam)    end  end  return windowendlocal CreateFolderButton = function(parent)  local openButton = parent:CreateChildWidget("button", "openButton", 0, true)  openButton:AddAnchor("TOPRIGHT", parent, 0, 1)  ApplyButtonSkin(openButton, BUTTON_CONTENTS.MAP_FILTER_OPEN)  local closeButton = parent:CreateChildWidget("button", "closeButton", 0, true)  closeButton:AddAnchor("TOPRIGHT", parent, 0, 1)  ApplyButtonSkin(closeButton, BUTTON_CONTENTS.MAP_FILTER_CLOSE)  return openButton, closeButtonendlocal CreateDetailGroupCheckWindow = function(id, parent, type)  local window = parent:CreateChildWidget("window", id, 0, true)  window:Show(true)  window:SetHeight(#type * 20)  local group = CreateFilterCheckGroupWindow(window:GetId() .. ".group", window, type)  group:AddAnchor("TOPLEFT", window, 15, 0)  window.group = group  return windowendlocal SetFolderControlHandler_2 = function(widget, folder)  widget.folder = folder  local scrollWindow = folder:GetParent()  scrollWindow = scrollWindow:GetParent()  function widget:OnClick()    if self.folder == nil then      return    end    self.folder:ToggleState()    ResetScroll(scrollWindow, mapFrame:GetHeight())  end  widget:SetHandler("OnClick", widget.OnClick)endlocal function CreateCheckFolder(id, parent, text, type)  local allCheck = CreateCheckButton(parent:GetId() .. ".allCheck", parent)  local folder = UIParent:CreateWidget("folder", parent:GetId() .. ".folder", parent)  folder:SetExtent(170, 16)  folder.height = parent.height  folder.flexibleHeight = parent.height  allCheck:AddAnchor("TOPLEFT", folder, 0, 1)  allCheck:Raise()  folder.allCheck = allCheck  local openButton, closeButton = CreateFolderButton(folder)  folder:SetOpenStateButton(openButton)  folder:SetCloseStateButton(closeButton)  folder:UseAnimation(true)  folder:SetTitleHeight(19)  folder:SetAnimateStep(1.5)  local table = {}  if type == "normal" then    table = mapLocale.filtericon_table  elseif type == "npc" then    table = mapLocale.filtericon_npc_table    allCheck.iconType = M_NPC_FILTER  elseif type == "doodad" then    table = mapLocale.filtericon_doodad_table    allCheck.iconType = M_DOODAD_FILTER  elseif type == "house" then    table = mapLocale.filtericon_house_table    allCheck.iconType = M_HOUSE_FILTER  end  folder:SetExtendLength((#table + 1) * 23 + 5)  folder.openHeight = (#table + 1) * 23 + 27  folder.closeHeight = 22  SetFolderControlHandler_2(openButton, folder)  SetFolderControlHandler_2(closeButton, folder)  local textButton = folder:CreateChildWidget("button", "textButton", 0, true)  textButton:Show(true)  textButton:SetText(text)  textButton.style:SetFont(FONT_PATH.DEFAULT, FONT_SIZE.MIDDLE)  SetButtonFontColor(textButton, GetTitleButtonFontColor())  textButton.style:SetAlign(ALIGN_LEFT)  textButton.style:SetSnap(true)  folder:SetInset(20, 0, -20, 0)  folder:SetTitleButtonWidget(textButton)  SetFolderControlHandler_2(textButton, folder)  local detailCheck = CreateDetailGroupCheckWindow(folder:GetId() .. ".detailCheck", folder, type)  folder:SetChildWidget(detailCheck)  folder.detailCheck = detailCheck  return folderendfunction SetViewOfScrollFilterWindow(id, parent)  local window = CreateScrollWindow(parent, id, 0)  window:SetExtent(195, 440)  local title = window:CreateChildWidget("label", "title", 0, true)  title:SetAutoResize(true)  title:SetHeight(FONT_SIZE.LARGE)  title.style:SetFontSize(FONT_SIZE.LARGE)  title:SetText(locale.map.showIcon)  title:AddAnchor("BOTTOMLEFT", window, "TOPLEFT", 0, -7)  ApplyTextColor(title, FONT_COLOR.TITLE)  local normalCheckGroup = CreateFilterCheckGroupWindow(window:GetId() .. ".normalCheckGroup", window.content, "normal")  normalCheckGroup:AddAnchor("TOPLEFT", window.content, 0, -2)  window.normalCheckGroup = normalCheckGroup  window.firstHeight = normalCheckGroup:GetHeight()  local npcFolder = CreateCheckFolder(window:GetId() .. ".npcFolder", window.content, locale.map.getSymbolText("M_NPC"), "npc")  npcFolder:AddAnchor("TOPLEFT", normalCheckGroup, "BOTTOMLEFT", 0, 0)  window.npcFolder = npcFolder  local doodadFolder = CreateCheckFolder(window:GetId() .. ".doodadFolder", window.content, locale.map.getSymbolText("M_DOODAD"), "doodad")  doodadFolder:AddAnchor("TOPLEFT", npcFolder, "BOTTOMLEFT", 0, 3)  window.doodadFolder = doodadFolder  local houseFolder = CreateCheckFolder(window:GetId() .. ".houseFolder", window.content, locale.map.getSymbolText("M_HOUSE"), "house")  houseFolder:AddAnchor("TOPLEFT", doodadFolder, "BOTTOMLEFT", 0, 3)  window.houseFolder = houseFolder  return windowendfunction CreateScrollFilterWindow(id, parent)  local window = SetViewOfScrollFilterWindow(id, parent)  window:SetHeight(window:GetHeight() - 50)  return windowendlocal sideMargin, titleMargin, bottomMargin = GetWindowMargin()local scrollFilterWindow = CreateScrollFilterWindow("scrollFilterWindow", mapFrame)scrollFilterWindow:AddAnchor("TOPLEFT", mapWindow, "TOPRIGHT", sideMargin / 1.5, 15)mapFrame:InsertHideTarget(scrollFilterWindow)function mapFrame:GetHeight()  local height = mapFrame.scrollFilterWindow.firstHeight  if mapFrame.scrollFilterWindow.npcFolder:GetState() == "opening" or mapFrame.scrollFilterWindow.npcFolder:GetState() == "open" then    height = height + mapFrame.scrollFilterWindow.npcFolder.openHeight  else    height = height + mapFrame.scrollFilterWindow.npcFolder.closeHeight  end  if mapFrame.scrollFilterWindow.doodadFolder:GetState() == "opening" or mapFrame.scrollFilterWindow.doodadFolder:GetState() == "open" then    height = height + mapFrame.scrollFilterWindow.doodadFolder.openHeight  else    height = height + mapFrame.scrollFilterWindow.doodadFolder.closeHeight  end  if mapFrame.scrollFilterWindow.houseFolder:GetState() == "opening" or mapFrame.scrollFilterWindow.houseFolder:GetState() == "open" then    height = height + mapFrame.scrollFilterWindow.houseFolder.openHeight  else    height = height + mapFrame.scrollFilterWindow.houseFolder.closeHeight  end  return heightend